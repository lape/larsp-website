<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- Begin Bridgetown SEO tag v6.0.0 -->
<title>Generating barcode PDFs with Rails | larsp.dev</title>
<meta property="og:title" content="Generating barcode PDFs with Rails" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Using Barby and Prawn to imprint PDFs with individual barcodes." />
<meta property="og:description" content="Using Barby and Prawn to imprint PDFs with individual barcodes." />
<link rel="canonical" href="https://larsp.dev/rails/generating-barcode-pdfs/" />
<meta property="og:url" content="https://larsp.dev/rails/generating-barcode-pdfs/" />
<meta property="og:site_name" content="larsp.dev" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-08-09T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Generating barcode PDFs with Rails" />
<meta name="twitter:site" content="@lape" />
<!-- End Bridgetown SEO tag -->


<link type="application/atom+xml" rel="alternate" href="https://larsp.dev/feed.xml" title="larsp.dev" />
<link rel="icon" type="image/x-icon" href="/images/favicon.ico">
<link rel="stylesheet" href="/_bridgetown/static/index.CCDETTG4.css">
<script src="/_bridgetown/static/index.Y6AD6WRO.js" defer></script>

</head>
<body class="layout-post post ">
  <nav
  class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">

  <div class="container pr-0">

    <a class="navbar-brand" href="/">
      <h1 class="sitetitle">larsp.dev</h1>
    </a>

    <button class="navbar-toggler" type="button" data-toggle="collapse"
      data-target="#navbarMediumish" aria-controls="navbarSupportedContent"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarMediumish">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="/">Home</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/about/">About</a>
        </li>

        <li class="nav-item">
          <a class="nav-link" href="/now/">Now</a>
        </li>
      </ul>
    </div>
  </div>
</nav>

    <div class="site-content">
      <div class="container">
        <div class="mainheading">
          <p class="lead">
            larsp’s personal site
          </p>
        </div>
        <div class="main-content">
          <div class="container">
  <div class="row">
    <div class="col-md-2 pl-0">
      <div class="share sticky-top sticky-top-offset">
        <ul>
          <li class="ml-1 mr-1">
            <a href="mailto:?subject=Generating barcode PDFs with Rails&amp;body=https://larsp.dev/rails/generating-barcode-pdfs/" title="Share link by email" rel="_blank">
              <i class="fa-solid fa-envelope"></i>
            </a>
          </li>
          <li class="ml-1 mr-1">
            <a href="#" title="Copy link to clipboard"
              onclick="let url = document.location.href;navigator.clipboard.writeText(url)">
              <i class="fa-solid fa-clipboard"></i>
            </a>
          </li>
          <li class="ml-1 mr-1">
            <a target="_blank" href="https://ruby.social/web/statuses/new"
              rel="nofollow" title="Share on Mastodon"
              onclick="window.open(this.href, 'mastodon-share', 'width=550,height=435');return false;">
              <i class="fab fa-mastodon"></i>
            </a>
          </li>
          <li class="ml-1 mr-1">
            <a target="_blank" title="Share on Twitter"
              href="https://twitter.com/intent/tweet?text=Generating barcode PDFs with Rails&url=https://larsp.dev/rails/generating-barcode-pdfs/"
              onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
              <i class="fab fa-twitter"></i>
            </a>
          </li>
          <li class="ml-1 mr-1">
            <a target="_blank" title="Share on LinkedIn"
              href="https://www.linkedin.com/shareArticle?mini=true&url=https://larsp.dev/rails/generating-barcode-pdfs/"
              onclick="window.open(this.href, 'width=550,height=435');return false;">
              <i class="fab fa-linkedin-in"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="col-md-9 flex-first flex-md-unordered">
      <article>
        <div class="mainheading">
          <h1 class="posttitle">
            Generating barcode PDFs with Rails
          </h1>
        </div>
        <div class="article-post">
          <p>For a project, I was researching methods to generate individual PDFs with imprinted EAN barcodes. Some of the how-tos and blog articles I found were quite old, and it was not directly obvious if the solution still works and can be recommended in 2023. The following represents my short note-taking of a decent way to do this. There may be other or better ways, but this one works for me.</p>

<p><a href="https://github.com/toretore/barby">Barby</a> is a barcode generator library for Ruby. It generates a barcode as an image or as a PDF. For creating the actual PDF with background image I am using the <a href="https://github.com/prawnpdf/prawn">Prawn</a> PDF generation library for Ruby. It produces PDFs from scratch and annotates existing PDFs with text, images, and barcodes.</p>

<p>I am using two model classes, one for the voucher with the <em>code</em> property (which shall be printed as a barcode), and one for the PDF generation. The PDF generation class is a subclass of <em>Prawn::Document</em>. It takes a path and a code as arguments and generates a PDF with the barcode imprinted. The voucher class creates a temporary file, calls the PDF generation class, and returns the path to the temporary file. As we are using Rails <em>Tempfile</em>, the temporary file is deleted automatically when the Rails process exits.</p>

<p>The resulting PDF should be 100mm x 133mm with a png as the background image. At first, I experimented with the <em>background</em> option of <em>Prawn::Document</em>, but this did not work as expected. The background image didn’t scale to the page size. Instead, I am using the <em>image</em> method to draw the background image. The <em>fit</em> option scales the image to the page size.</p>

<p>Prawn’s measurement_extensions allow the use of mm as a unit for the page size instead of the default 1/72 inch.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">require</span> <span class="s2">"barby/barcode/code_128"</span>
<span class="nb">require</span> <span class="s2">"barby/outputter/prawn_outputter"</span>
<span class="nb">require</span> <span class="s2">"prawn/measurement_extensions"</span>

<span class="k">class</span> <span class="nc">CodePdf</span> <span class="o">&lt;</span> <span class="no">Prawn</span><span class="o">::</span><span class="no">Document</span>
  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">path</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">background</span>
    <span class="k">super</span><span class="p">({</span>
      <span class="ss">page_size: </span><span class="p">[</span><span class="mi">100</span><span class="p">.</span><span class="nf">mm</span><span class="p">,</span> <span class="mi">177</span><span class="p">.</span><span class="nf">mm</span><span class="p">],</span>
      <span class="ss">margin: </span><span class="mi">0</span>
    <span class="p">})</span>

    <span class="n">image</span> <span class="n">background</span><span class="p">,</span> <span class="ss">fit: </span><span class="p">[</span><span class="mi">100</span><span class="p">.</span><span class="nf">mm</span><span class="p">,</span> <span class="mi">177</span><span class="p">.</span><span class="nf">mm</span><span class="p">]</span>
    <span class="n">barcode</span> <span class="n">code</span>
    <span class="n">render_file</span> <span class="n">path</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">barcode</span> <span class="n">code</span>
    <span class="n">barcode</span> <span class="o">=</span> <span class="no">Barby</span><span class="o">::</span><span class="no">Code128</span><span class="p">.</span><span class="nf">new</span> <span class="n">code</span>
    <span class="n">barcode</span><span class="p">.</span><span class="nf">annotate_pdf</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">height: </span><span class="mi">18</span><span class="p">.</span><span class="nf">mm</span><span class="p">,</span> <span class="ss">x: </span><span class="mi">17</span><span class="p">.</span><span class="nf">mm</span><span class="p">,</span> <span class="ss">y: </span><span class="mi">3</span><span class="p">.</span><span class="nf">mm</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<p>In the <em>code</em> class, we create a temporary file and call the PDF generation class. The background image is found in the <em>app/assets/images/{language}</em> directory. The name of the background image is stored in the <em>voucher</em> property of the <em>price</em> object (where the <em>code</em> belongs_to). The <em>voucher</em> property is a string like <em>voucher.png</em>. The <em>I18n.locale</em> method returns the current locale, e.g. <em>de</em> or <em>fr</em> which is used to find the correct background image.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">voucher</span>
  <span class="c1"># Create temporary file e.g. tmp/voucher20230805-66997-kozjms.pdf</span>
  <span class="n">tmpfile</span> <span class="o">=</span> <span class="no">Tempfile</span><span class="p">.</span><span class="nf">new</span> <span class="s2">"voucher"</span><span class="p">,</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">"tmp"</span><span class="p">)</span>
  <span class="n">path</span> <span class="o">=</span> <span class="n">tmpfile</span><span class="p">.</span><span class="nf">path</span> <span class="o">+</span> <span class="s2">".pdf"</span>
  <span class="n">bg_path</span> <span class="o">=</span> <span class="no">Rails</span><span class="p">.</span><span class="nf">root</span><span class="p">.</span><span class="nf">join</span> <span class="s2">"app"</span><span class="p">,</span> <span class="s2">"assets"</span><span class="p">,</span> <span class="s2">"images"</span><span class="p">,</span> <span class="no">I18n</span><span class="p">.</span><span class="nf">locale</span><span class="p">.</span><span class="nf">to_s</span><span class="p">,</span> <span class="n">price</span><span class="p">.</span><span class="nf">voucher</span>
  <span class="no">CodePdf</span><span class="p">.</span><span class="nf">new</span> <span class="n">path</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="n">bg_path</span>
  <span class="n">path</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Here is an example of the resulting voucher PDF with the barcode imprinted:</p>

<p style="text-align:center; filter:drop-shadow(5px 5px 5px #aaa)"><img src="/images/voucherpdf.png" alt="PDF with barcode" /></p>

        </div>
      </article>
      <hr>
      <div class="commentbox"></div>
    </div>
  </div>
</div>

        </div>
      </div>
      <footer class="footer">
        
      </footer>
    </div>
</body>
</html>
